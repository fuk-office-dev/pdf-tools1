<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFçµåˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        .pdf-merger-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .upload-area {
            border: 3px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }
        
        .upload-area.dragover {
            border-color: #007bff;
            background-color: #e6f2ff;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 30px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        .file-input-label:hover {
            background-color: #0056b3;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .file-list {
            margin: 20px 0;
            display: none;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        
        .file-item:hover {
            background-color: #dee2e6;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .file-name {
            font-weight: 500;
            color: #333;
        }
        
        .file-pages {
            color: #666;
            font-size: 14px;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        .move-button, .remove-button {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .move-button {
            background-color: #6c757d;
            color: white;
        }
        
        .move-button:hover {
            background-color: #5a6268;
        }
        
        .remove-button {
            background-color: #dc3545;
            color: white;
        }
        
        .remove-button:hover {
            background-color: #c82333;
        }
        
        .merge-button {
            padding: 15px 40px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: none;
        }
        
        .merge-button:hover {
            background-color: #218838;
        }
        
        .merge-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .progress {
            margin: 20px 0;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .result {
            margin-top: 30px;
            display: none;
        }
        
        .success-message {
            padding: 15px;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            color: #155724;
            margin-bottom: 20px;
        }
        
        .error-message {
            padding: 15px;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            color: #721c24;
            margin-bottom: 20px;
        }
        
        .reset-button {
            padding: 10px 25px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .reset-button:hover {
            background-color: #5a6268;
        }
        
        .info-box {
            padding: 15px;
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            color: #0c5460;
            margin-bottom: 20px;
        }
        
        .clear-all-button {
            padding: 8px 20px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
        }
        
        .clear-all-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <div class="pdf-merger-container">
        <h1 style="text-align: center; color: #333;">PDFçµåˆãƒ„ãƒ¼ãƒ«</h1>
        <p style="text-align: center; color: #666;">è¤‡æ•°ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ã¤ã«çµåˆã§ãã¾ã™ã€‚ã™ã¹ã¦ã®å‡¦ç†ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§è¡Œã‚ã‚Œã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤–éƒ¨ã«é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</p>
        
        <div class="upload-area" id="uploadArea">
            <p style="font-size: 18px; color: #666; margin-bottom: 15px;">
                ğŸ“„ PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯
            </p>
            <label for="pdfFiles" class="file-input-label">
                ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰
            </label>
            <input type="file" id="pdfFiles" accept=".pdf" multiple>
            <p style="font-size: 14px; color: #999; margin-top: 15px;">
                â€» è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€åº¦ã«é¸æŠã§ãã¾ã™
            </p>
        </div>
        
        <div class="file-list" id="fileList">
            <div class="info-box">
                ğŸ“Œ ãƒ•ã‚¡ã‚¤ãƒ«ã®é †åºã‚’å¤‰æ›´ã™ã‚‹ã«ã¯ã€Œâ†‘ã€ã€Œâ†“ã€ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ä¸Šã‹ã‚‰é †ã«çµåˆã•ã‚Œã¾ã™ã€‚
            </div>
            <button class="clear-all-button" id="clearAllButton">ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>
            <div id="filesContainer"></div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="merge-button" id="mergeButton">çµåˆã‚’å®Ÿè¡Œ</button>
        </div>
        
        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
            </div>
        </div>
        
        <div class="result" id="result"></div>
    </div>

    <script>
        const { PDFDocument } = PDFLib;
        
        let pdfFiles = [];
        
        const uploadArea = document.getElementById('uploadArea');
        const pdfFilesInput = document.getElementById('pdfFiles');
        const fileList = document.getElementById('fileList');
        const filesContainer = document.getElementById('filesContainer');
        const mergeButton = document.getElementById('mergeButton');
        const clearAllButton = document.getElementById('clearAllButton');
        const progress = document.getElementById('progress');
        const progressFill = document.getElementById('progressFill');
        const result = document.getElementById('result');
        
        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
            if (files.length > 0) {
                handleFiles(files);
            }
        });
        
        pdfFilesInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                handleFiles(files);
            }
        });
        
        async function handleFiles(files) {
            for (const file of files) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer);
                    const numPages = pdfDoc.getPageCount();
                    
                    pdfFiles.push({
                        name: file.name,
                        data: arrayBuffer,
                        pages: numPages
                    });
                } catch (error) {
                    showError(`${file.name} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
                }
            }
            
            updateFileList();
            pdfFilesInput.value = '';
        }
        
        function updateFileList() {
            if (pdfFiles.length === 0) {
                fileList.style.display = 'none';
                mergeButton.style.display = 'none';
                clearAllButton.style.display = 'none';
                return;
            }
            
            fileList.style.display = 'block';
            mergeButton.style.display = 'inline-block';
            clearAllButton.style.display = 'inline-block';
            
            filesContainer.innerHTML = '';
            
            pdfFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <span style="font-weight: bold; color: #007bff;">${index + 1}.</span>
                        <span class="file-name">${file.name}</span>
                        <span class="file-pages">(${file.pages}ãƒšãƒ¼ã‚¸)</span>
                    </div>
                    <div class="file-actions">
                        ${index > 0 ? '<button class="move-button" onclick="moveUp(' + index + ')">â†‘</button>' : '<button class="move-button" disabled style="opacity: 0.3;">â†‘</button>'}
                        ${index < pdfFiles.length - 1 ? '<button class="move-button" onclick="moveDown(' + index + ')">â†“</button>' : '<button class="move-button" disabled style="opacity: 0.3;">â†“</button>'}
                        <button class="remove-button" onclick="removeFile(${index})">å‰Šé™¤</button>
                    </div>
                `;
                filesContainer.appendChild(fileItem);
            });
        }
        
        window.moveUp = function(index) {
            if (index > 0) {
                [pdfFiles[index], pdfFiles[index - 1]] = [pdfFiles[index - 1], pdfFiles[index]];
                updateFileList();
            }
        }
        
        window.moveDown = function(index) {
            if (index < pdfFiles.length - 1) {
                [pdfFiles[index], pdfFiles[index + 1]] = [pdfFiles[index + 1], pdfFiles[index]];
                updateFileList();
            }
        }
        
        window.removeFile = function(index) {
            pdfFiles.splice(index, 1);
            updateFileList();
        }
        
        clearAllButton.addEventListener('click', () => {
            if (confirm('ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹?')) {
                pdfFiles = [];
                updateFileList();
            }
        });
        
        mergeButton.addEventListener('click', async () => {
            if (pdfFiles.length < 2) {
                showError('å°‘ãªãã¨ã‚‚2ã¤ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                return;
            }
            
            mergeButton.disabled = true;
            progress.style.display = 'block';
            result.style.display = 'none';
            
            try {
                await mergePDFs();
                showSuccess('çµåˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            } catch (error) {
                showError('çµåˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
            
            mergeButton.disabled = false;
        });
        
        async function mergePDFs() {
            const mergedPdf = await PDFDocument.create();
            
            for (let i = 0; i < pdfFiles.length; i++) {
                updateProgress((i / pdfFiles.length) * 100);
                
                const pdfDoc = await PDFDocument.load(pdfFiles[i].data);
                const pageCount = pdfDoc.getPageCount();
                const pageIndices = Array.from({length: pageCount}, (_, idx) => idx);
                
                const copiedPages = await mergedPdf.copyPages(pdfDoc, pageIndices);
                copiedPages.forEach(page => mergedPdf.addPage(page));
            }
            
            updateProgress(100);
            
            const mergedPdfBytes = await mergedPdf.save();
            downloadPDF(mergedPdfBytes, 'merged.pdf');
        }
        
        function downloadPDF(pdfBytes, filename) {
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function updateProgress(percent) {
            const rounded = Math.round(percent);
            progressFill.style.width = `${rounded}%`;
            progressFill.textContent = `${rounded}%`;
        }
        
        function showSuccess(message) {
            result.innerHTML = `
                <div class="success-message">
                    âœ… ${message}
                </div>
                <button class="reset-button" onclick="resetForm()">åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ</button>
            `;
            result.style.display = 'block';
            progress.style.display = 'none';
        }
        
        function showError(message) {
            result.innerHTML = `
                <div class="error-message">
                    âŒ ${message}
                </div>
            `;
            result.style.display = 'block';
            setTimeout(() => {
                result.style.display = 'none';
            }, 5000);
        }
        
        window.resetForm = function() {
            pdfFiles = [];
            updateFileList();
            result.style.display = 'none';
            progress.style.display = 'none';
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';
        }
    </script>
</body>
</html>
